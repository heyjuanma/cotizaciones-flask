<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Cotizaciones</title>
<script>
let items = [];

function addItem() {
    let c = cantidad.value;
    let d = detalle.value;
    let p = precio.value;
    let m = c * p;

    items.push({cantidad: c, detalle: d, precio: p, monto: m});
    render();
}

function render() {
    table.innerHTML = "";
    let subtotal = 0;

    items.forEach(i => {
        subtotal += i.monto;
        table.innerHTML += `<tr>
            <td>${i.cantidad}</td>
            <td>${i.detalle}</td>
            <td>${i.precio}</td>
            <td>${i.monto}</td>
        </tr>`;
    });

    document.getElementById("items").value = JSON.stringify(items);
    document.getElementById("subtotal").innerText = subtotal.toFixed(2);
    document.getElementById("total").innerText = (subtotal * 1.13).toFixed(2);
}
</script>
</head>
<body>

<h1>Nueva Cotización</h1>

<form method="POST">
<input name="nombre_cliente" placeholder="Cliente" required><br>
<input name="contacto" placeholder="Contacto"><br>
<input name="email" placeholder="Email"><br>
<input name="telefono" placeholder="Teléfono"><br>

<input name="titulo_proyecto" placeholder="Título proyecto"><br>
<textarea name="descripcion" placeholder="Descripción"></textarea><br>

<select name="instalado">
<option>SI</option>
<option>NO</option>
</select>

<select name="diseno">
<option>SI</option>
<option>NO</option>
</select>

<h3>Detalle</h3>
<input id="cantidad" type="number" placeholder="Cantidad">
<input id="detalle" placeholder="Detalle">
<input id="precio" type="number" placeholder="Precio">
<button type="button" onclick="addItem()">Agregar</button>

<table border="1">
<thead>
<tr><th>Cant</th><th>Detalle</th><th>Precio</th><th>Monto</th></tr>
</thead>
<tbody id="table"></tbody>
</table>

<input type="hidden" id="items" name="items">

<p>Subtotal: ₡<span id="subtotal">0</span></p>
<p>Total +13%: ₡<span id="total">0</span></p>

<button>Crear Cotización</button>
</form>

<hr>

<h2>Cotizaciones Guardadas</h2>

<ul>
{% for c in cotizaciones %}
<li>
Contrato #{{c.numero_registro}} - {{c.nombre_cliente}}
<a href="/descargar/{{c.id}}">Descargar PDF</a>
</li>
{% endfor %}
</ul>

</body>
</html>
